<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>Facelet Title</title>
    </h:head>
    <h:body>
        <h:form id="formCa">
            <p:growl  id="mensaje" autoUpdate="true" showSummary="false" showDetail="true" />
            <p:dataTable id="table" var="certificado" widgetVar="certificadoTable"  editable="true"
                         value="#{calificarCertificadoManaged.listaCertificado}" emptyMessage="No hay certificados"
                         filteredValue="#{calificarCertificadoManaged.filtartificado}">
                <f:facet name="header">
                    <p:inputText id="globalFilter" onkeyup="PF('certificadoTable').filter()" placeholder="Filtar por"/>

                </f:facet>

                <p:column headerText="Cedula" filterBy="#{certificado.documentoSolicitante}">
                    <p:cellEditor>
                        <f:facet name="input"><h:inputHidden id="certificado" value="#{certificado.idCertificado}"/></f:facet>
                        <f:facet name="output"><h:outputText value="#{certificado.documentoSolicitante}"></h:outputText></f:facet>
                        <f:facet name="input"><p:inputText id="documento" value="#{certificado.documentoSolicitante}"></p:inputText></f:facet>
                    </p:cellEditor>
                </p:column>                
                <p:column headerText="Opciones">
                    <p:commandButton icon="ui-icon-zoomin" title="Verificar historial de pagos" >
                        <p:ajax listener="#{calificarCertificadoManaged.consultarAsocidado(certificado.documentoSolicitante)}" />
                        <p:ajax listener="#{pagoManaged.consultarPagosAsociado(certificado.documentoSolicitante)}" />
                        <p:ajax onstart="PF('dlgPagosAsociado').show()" update=":formCa:displayPagosAsociado,:formCa:tabla" />
                    </p:commandButton>
                    <p:commandButton icon=" ui-icon-check" title="Aprobar" actionListener="#{calificarCertificadoManaged.aprobar(certificado.idCertificado)}"
                                     >
                        <p:ajax  update=":formCa" ></p:ajax>    
                    </p:commandButton>
                    <p:commandButton icon=" ui-icon-closethick" title="Rechazar" actionListener="#{calificarCertificadoManaged.rechazar(certificado.idCertificado)}"
                                     >

                    </p:commandButton>
                    <!--Faltaria otro boton que despliegue un dialog y en ese dialog mostrar los ultimos pagos del asociado -->
                </p:column>
            </p:dataTable>

            <p:dialog widgetVar="dlgPagosAsociado" header="Pagos asociado">
                <p:panelGrid id="displayPagosAsociado" columnClasses="label,value" columns="2">
                    <p:outputLabel value="Cédula:" />
                    <p:outputLabel value="#{calificarCertificadoManaged.asociadoSelect.cedula}" />
                    <p:outputLabel value="Nombre:" />
                    <p:outputLabel value="#{calificarCertificadoManaged.asociadoSelect.nombre} #{calificarCertificadoManaged.asociadoSelect.apellido}" />
                </p:panelGrid>                
                <p:dataTable id="tabla" var="pago" value="#{pagoManaged.listaPagos}" widgetVar="pagoTable" style="font-family: calibri; width: 100%;"                         
                             emptyMessage="No hay registros" filteredValue="#{pagoManaged.filtroPagos}"
                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} "
                             paginator="true"
                             selectionMode="single"           
                             rowKey="#{pago.numeroRecibo}"
                             rows="6"                                             
                             >

                    <f:facet name="header">
                        <p:outputPanel style="text-align: right" > 
                            <p:outputLabel value="Tipo de pago:" for="tipoPago1" style="float:left; margin-top: 6px;" />
                            <p:selectOneMenu value="#{pagoManaged.listarPor}" id="tipoPago1" style="width:180px; text-align: left; float: left; margin-top: 5px; margin-left: 5px;" >
                                <f:selectItem  itemLabel="Todos" itemValue="-1"/>
                                <f:selectItems var="tipoPago1" itemLabel="#{tipoPago1.nombrePago}" itemValue="#{tipoPago1.idTipoPago}" 
                                               value="#{tipoPagoManaged.listaTipoPagoTabla}" />                            
                                <p:ajax listener="#{pagoManaged.listarPor()}" update=":formCa"  />
                                <p:ajax onstart="PF('pagoTable').filter()" />
                            </p:selectOneMenu>                                            
                            <p:inputText id="globalFilter" onkeyup="PF('pagoTable').filter()" style="width:150px; " placeholder="Buscar" />                        
                        </p:outputPanel>                   
                    </f:facet>

                    <p:column headerText="Tipo de pago" sortBy="#{pago.idTipoPago.nombrePago}" filterBy="#{pago.idTipoPago.nombrePago}" filterStyle="display:none"  filterMatchMode="contains">                    
                        <h:outputText value="#{pago.idTipoPago.nombrePago}" />
                    </p:column>
                    <p:column headerText="Número de recibo" sortBy="#{pago.numeroRecibo}" filterBy="#{pago.numeroRecibo}" filterStyle="display:none"  filterMatchMode="contains">                
                        <h:outputText value="#{pago.numeroRecibo}" />
                    </p:column>                
                    <p:column headerText="Cedula" filterBy="#{pago.idAsociado.cedula}" filterStyle="display:none"  filterMatchMode="contains">                    
                        <h:outputText value="#{pago.idAsociado.cedula}" />
                    </p:column>                
                    <p:column headerText="Fecha del pago" sortBy="#{pago.fechaPago}" filterBy="#{pago.fechaPago}" filterStyle="display:none"  filterMatchMode="contains">                
                        <h:outputText value="#{pago.fechaPago}" style="width:100%" ><f:convertDateTime pattern="dd/MM/yyyy" /></h:outputText>
                    </p:column>                                         
                </p:dataTable>   

            </p:dialog>            
        </h:form>
    </h:body>
</html>

